<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AI è¯­éŸ³æ§åˆ¶å°</title>
    <style>
        /* ç®€å•çš„æ ·å¼ */
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background-color: #2c3e50; color: white; margin: 0; }
        .mic-btn {
            width: 120px; height: 120px; border-radius: 50%; border: none; cursor: pointer;
            background: #e74c3c; box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7);
            font-size: 40px; color: white; transition: all 0.3s; display: flex; align-items: center; justify-content: center;
        }
        .mic-btn.recording { animation: pulse 1.5s infinite; background: #c0392b; }
        .mic-btn:active { transform: scale(0.95); }
        .status { margin-top: 30px; font-size: 18px; color: #ecf0f1; height: 30px;}
        .tips { margin-top: 10px; font-size: 12px; color: #95a5a6; }

        @keyframes pulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 20px rgba(231, 76, 60, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }
    </style>
</head>
<body>

    <button id="recordBtn" class="mic-btn">ğŸ™ï¸</button>
    <div id="status" class="status">æŒ‰ä½è¯´è¯ï¼Œæ¾å¼€å‘é€</div>
    <div class="tips">å½•éŸ³å°†è‡ªåŠ¨æäº¤ç»™ Research Team</div>

<script>
    const UPLOAD_API = "http://localhost:8081/upload"; 
    let mediaRecorder;
    let audioChunks = [];
    const btn = document.getElementById('recordBtn');
    const status = document.getElementById('status');

    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
        mediaRecorder.onstop = uploadAudio;
    }).catch(e => {
        status.innerText = "âŒ è¯·å…è®¸éº¦å…‹é£æƒé™";
        btn.style.background = "#7f8c8d";
    });

    btn.addEventListener('mousedown', () => {
        if (mediaRecorder && mediaRecorder.state === "inactive") {
            audioChunks = [];
            mediaRecorder.start();
            btn.classList.add('recording');
            status.innerText = "æ­£åœ¨è†å¬...";
        }
    });

    btn.addEventListener('mouseup', () => {
        if (mediaRecorder && mediaRecorder.state === "recording") {
            mediaRecorder.stop();
            btn.classList.remove('recording');
            status.innerText = "æ­£åœ¨å¤„ç†...";
        }
    });

    async function uploadAudio() {
        const blob = new Blob(audioChunks, { type: 'audio/wav' });
        const formData = new FormData();
        formData.append("file", blob, "voice_cmd.wav");

        try {
            status.innerText = "ğŸš€ å‘é€ç»™ Agent...";
            const res = await fetch(UPLOAD_API, { method: "POST", body: formData });
            const data = await res.json();
            
            if (data.status === "success" || data.path) {
                status.innerText = "âœ… æŒ‡ä»¤å·²é€è¾¾ï¼è¯·çœ‹èŠå¤©çª—å£";
                setTimeout(() => status.innerText = "æŒ‰ä½è¯´è¯ï¼Œæ¾å¼€å‘é€", 3000);
            } else {
                status.innerText = "âš ï¸ ä¸Šä¼ å¼‚å¸¸";
            }
        } catch (e) {
            console.error(e);
            status.innerText = "âŒ è¿æ¥å¤±è´¥ (æ£€æŸ¥ upload_server)";
        }
    }
</script>
</body>
</html>